# JPA 교육

pass팀 이명현

https://yobi.navercorp.com/jpa/posts/10
https://oss.navercorp.com/mhyeon-lee/edu-jpa-modeling

10분에 시작한다고 이럴줄 알았음 똥싸고 왔지

JPA - Java ORM 라이브러리 (annotation 사용) 

# 객체와 테이블 연관관계의 차이점
 * 테이블은 FK로 연관: 양방향
 * 객체는 참조(reference)로 연관: 단방향
   (양방향으로 만들기 위해서는, 1:N에서 1쪽 class에 ```List 참조```를 넣어준다)

## 연관관계 매핑 키워드 

* 방향 : [단방향, 양방향] 이 있다.
* 다중성 : [다대일(N:1), 일대다(1:N), 일대일(1:1), 다대다(N:M)] 다중성이 있다.
* 연관관계 주인 : 객체 관계를 주도하는 주인을 지정한다.
 - N쪽이 주인 1쪽이 client(```List 참조``` - 의 경우는 업데이트 안됨. 조회만 된다)
 
## 양방향 
 * 양방향 관리를 위해서는 1쪽 N쪽 관리 코드가 들어가야 하는 주의가 필요하다 
 * 주인쪽에서 등록/수정/삭제가 가능하도록, N쪽에 관리 로직 들어가야 한다 

## 다대일 매핑
 * Team (1) - (N) Member
 * Member 클래스에 setTeam() 메소드에서 등록을 관리한다 
 * why? Member 클래스가 주인
 * Team.getMembers().add(member) <-- 이건 DB에 반영되지 않는다
 
## 일대다 매핑
  * 일(1) 쪽에서 연관관계의 주인 으로 설정
  * @OneToMany 를 사용하고 외래 키(FK)를 반대편 테이블에서 관리
  * 일대다 단방향 관계를 매핑할 때는 @JoinColumn 을 명시, 
  * 그렇지 않으면, JPA 는 연결 테이블을 중간에 둔다. 마치 다대다 처럼 ...

## 일대일 매핑
  * 어느쪽이 FK를 가져도 됨
  * FK를 가지는 쪽이 주인이 됨
  * 일대일 양방향 고객쪽이 mappedBy=
  * 식별관계 : 자식 테이블 PK가 곧FK인 경우 (주인ID가 곧 고객ID) 
  * 식별관계 : mapId
  * DB설계와 JPA가 가장 충돌나는 케이스임 
    - FK가 자식 테이블에 존재 : DB설계
    - 부모가 자식의 참조 가짐 : JPA - 객체 설
  
## 다대다 매핑 
  * 객체에서는 양쪽에서 참조 리스트를 가지면 표현가능
  * DB에서는 연결테이블로 표현
  * 연결테이블에 추가 컬럼을 추가할수 없다.

## 연결 엔티티 매핑
  * 연결테이블에 추가 컬럼을 필요한 경우
  * 테이블 3개 연결테이블에 일대다 일대다 관계 넣음
  * 되도록 양방향 연결은 한쪽만 할것..

## 연결 엔티티 식별관계 매핑
  * DB위주 모델링 했을때 발생
  * @ID @ManyToOne
  
## 값타입
  * 엔티티: 식별자가 있고 관계를 가진다 @Entity
  * 값타입: 식별자가 없고 값을 가진다. int, String, @Embedded, @ElementCollection, 불변객체 (setter가 있음 안되지)
  
 
## 궁금점
  * 테이블명은 어찌 결정되나? Java Class명 camel을 underscore로 변환
  ```sql
  -- class OneToManyBidirectionMapping  {
      create table one_to_many_bidirection_mapping$member ( 
          id bigint generated by default as identity,
          username varchar(255),
          team_id bigint,
          primary key (id)
      )
 
```

# 나름 정리
* ERM: 엔티티 릴레이션 모델, DB, 
* OOM: 객체지향모델, 객체,
* 주인: insert/update/delete DML 처리하는 클래스
* 고객: 관계 객체는 오직 read only
* 단방향, 양방향: DB에서는 없지만, ORM (JPA) 객체일때  


매핑 | 어노테이션 | 주인 클래스 
----|------|----------
다대일 단방향| @ManyToOne   | 다(N) 
다대일 양방향 | 고객 - @OneToMany(mappedBy = "team") | 다(N) | 
일대다 단방향 | @OneToMany | 일(1)
일대다 양방향 | 고객 - @JoinColumn(insertable = false, updatable = false) | 일(1)
일대일 단방향 | @OneToOne | 식별관계에서 부모쪽 (주어 has)
일대일 양방향 | 고객 - @OneToOne(mappedBy = "") | 
일대일 양방향 식별관계 | 고객 - @MapsId | 
다대다 단방향 | @ManyToMany @JoinTable | 
다대다 양방향 | 고객 - @ManyToMany(mapppedBy ="") |
연결엔티티 | ManyToOne, OneToMany | 



  